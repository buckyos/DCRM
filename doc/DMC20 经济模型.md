# DMC20 核心经济模型设计

相比DMC，DMC20的经济模型会更加简洁。希望通过一些简单的，可博弈的公式让每个人都能用自己的方式和策略，充满信心的加入到去中心存储市场中来。经济模型设计引导的博弈是阳谋，在推动整个去中心存储生态的算力规模增大的同时，推动DMC20价格的上涨。

## DMC20 挖矿的基本流程

### 存储交易市场挖矿

1. 出售存储资源的用户被称作供应商，可以挂卖单，卖单应详细的描述其存储资源的定义和价格。约定：

- 存储总大小，
- 存储单价（定价单位从0.125到8,单位是GWT(Gb per Week Token）
- 存储有效时间（系统规定最小有效期为24周），
- 单次购买的最小大小(需小设置为2GB)。
- 存储质量

2. 挂卖单时矿工用GWT缴纳质量保证金，用来在存储出现问题时赔付给用户。

```
保证金总额 = 卖单总空间*有效时间*单价*质保比率
```

系统有要求最小质保比率(0.5)，用户可以根据实际的市场竞争调高该保证金。存储价格，质保比率会影响供应方在算力奖励里的比率。
比如用户有100G空间，挂单24周，价格是2，质保比率是0.5,那么在挂单时，矿工需要准备好 `100*24*2*0.5 = 2400`个GWT的质保金。

3. 有需求的用户（需求方）可以选择一个已挂单购买自己需要的空间

```
存储费用=需求空间*剩余有效时间*单价。
```
用户并不能选择有效时间。当一个存储订单的剩余有效时间小于系统的最小存储有效时间时，用户无法购买该存储订单。为了降低GAS Fee，用户在购买空间时应设置数据的MixHash.

4. 已成交订单进入等待（数据）状态。数据交付的流程是需求方首先根据供应方公开的账号信息，通过链下协议将数据传输给供应商。供应商收到数据后调用合约接口确认该数据的MixHash。此后订单进入交付状态。

5. 未进入交付状态的订单双方都可以随时取消。取消后，用户会立刻得到退款，矿工则是回复了该存储订单的空间。

6. 订单进入交付状态12周后，可以调用“提现操作”，提现操作会让供应方得到收入+算力奖励GWT，让用户得到算力奖励GWT。此时系统会在该过程中抽取一部分交易费用GWT。

7. 矿工可以随时减少卖单的有效剩余空间。有效剩余空间减少后，矿工会得到退还的质保金。

8. 当矿工发现数据丢失时，可以主动声明数据丢失。此时只会赔付给用户质保金的80%，并拿回剩余的20%。

9.	供应方因为正常的技术理由可以申请订单请假（请假的频率基于有效长度有最大限制），订单请假期间其无法发起存储挑战。供应方可以在主动调用合约接口将请假状态的订单恢复正常。

10.	存储订单可以协议取消（一方发起，另一方同意），此时双方都会得到剩余交付时间的退款。

11. 使用官方的挖矿软件不会碰到其它异常情况，因此本文不讨论存储挑战等情况下的经济模型

### 公共数据挖矿

我们不提供公共数据挖矿的自动挖矿程序，公共数据挖矿更像是GWT持有者参与的另一个挖矿游戏。

从DApp的角度来说，公共数据挖矿的流程是：
1. 安装DApp
2. 在DApp的网页中配置存储空间
3. 通过质押GWT来获得有效的公共数据存储空间，目前该值为有效空间*16*64，也就是说获得1G的有效公共数据存储空间，需要质押1024个GWT.
4. 浏览公共数据，选中公共数据后尝试SHOW Proof来获得GWT
5. SHOW Proof会冻结（质押）一定数量的GWT，数量和SHOW成功后的回报有关。用户可以在SHOW之前通过DAapp的界面来决定质押的数量
    需要额外冻结的GWT一般与SHOW成功的回报有关。SHWO成功得到的回报越大，则需要冻结的GWT越多。
6. SHOW Proof会将公共数据的MixHash加入用户的公共数据持有列表，并消耗有效公共数据存储空间。
7. 用户可以随时释放公共数据来获得更多的有效公共数据存储空间
8. 通过释放未使用的公共数据存储空间，用户可以拿回质押的GWT

DApp提供了一系列API，可以让有技术的玩家制定更符合自己需要的策略来自动的玩公共数据存储挖矿，赢得更多的收益。



### 传输证明
1. 传输证明的核心是，矿工在给用户传输数据的过程中，用户不断确认 “矿工A在时间T内向用户B传输了数据D”
2. 实现上，关键是用户用专用工具（或带身份的网关）下载数据，并在获得数据的过程中提交传输证明
3. 矿工通过提交传输证明(的集合)，可以得到奖励
4. 传输证明可以是累计的，也可以是单次的。用一个sessionid来表达。同一个sessionid的传输证明，取时间戳最大的那个
5. 传输证明的验证者既可以是中心化的，也可以是一个去中心化合约。验证的关键是防止反复提交


### 用torrent发布公共数据
1. 我们可以验证一个种子是否被发布到DMC网络
2. 用户消耗手续费将种子发布到DMC网络
3. 对tracker进行改造

### BT下载挖矿
1. 用户发布种子，消耗GWT
2. 用户加速下载，消耗GWT
3. 用户A上传给用户B，用户B构造传输证明给A，随后用户A向Tracker提交传输证明成功，赚取GWT
4. 任何人都可以查询用户在某个文件上是否有足够的余额（每个用户都有通用余额和指定数据的专用余额）
5. 用户通过支付GWT，可以提高指定数据的余额
6. 用户A通过定义提交种子文件的存储证明，可以得到公共数据挖矿的奖励


## 算力奖励

算力奖励的是GWT
奖励的基本逻辑是：系统流通的GWT总量，要比系统的总存储能力略高。因此随着系统里存储能力的增加，GWT需要增发。

```
奖励 = 持有算力* 存储质量比率 * 系统挖矿难度比率 * 时长 
```

简单的说，1个100G的存储空间，1周获得的奖励是 100GWT *（存储质量比率 * 系统挖矿奖励比率）
存储质量比率和当前订单的 质押率和单价 有关。质押率越高，单价越高，质量存储比率越高。其取值范围是：0.05-8
系统挖矿奖励比率是系统当前的参数，与系统本周期的总算力增长率，GWT的总发行量，供需关系有关。系统算力增长越快，挖矿奖励比率越高。其取值范围是：
两个比率函数的最后都进入了一个平滑函数，用于限制最大值和最小值。并且通过曲线，我们把最佳收益点放在了价格为1，质押率为2的状态。（假1陪2）。系统增长率

系统的算力增长率每时每刻都在变化，从简化计算的逻辑来说，我们使用简单的平均数算法来得到一个近似值。
算力增长率 = （上一次提现时的算力增长率 + 提现时的算力增长率） / 2
长期来看，算力增长率是一个逐渐下降的函数。，因此，尽量减少提现次数能更好的吃到算力增长率早期较高的红利。

核心算法如下：

```python
def reward(self, capacity, duration,is_supply,order):
    # duration的单位是周
    return capacity * duration * get_quality_rate(order) * get_mining_rate(is_supply)

```

## 挂单奖励

目前的供需机制并未涉及挂单奖励。因此要的到算力奖励，核心就是要成交。（哪怕自己用小号去成交）

## 提现周期

提现周期是指存储订单开始后的最小周期。目前定义为12周（最小周期的一半）。

## DMC20矿工的基本策略

1. 根据自己的存储能力，决定存储的价格和质押率
2. 根据对挖矿奖励的期望，决定存储的价格和质押率
3. 适当的挂出卖单，因为每次挂单都有可能真正的锁定GWT质押，因此需要谨慎操作
4. 手工撤回为成交的卖单，已得到质押GWT的立刻退还
5. 自动的处理存储订单的交付，也可手工处理黑名单用户的订单。
6. 理解挖矿规则后，从节约手续费、锁定有利的系统参数、以及及时获得流动性3个角度在合适的时候提现。
7. 在GWT全链转换的基础上，认证思考如何在不同链上挖矿（寻找挖矿难度更低的链），以及合适转移GWT

## 交易费用

针对任何处于交付状态的订单进行提现，都会收取交易费用。

在存储交易的过程中，合约会抽取一部分比率的交易费用。比如买家花了1000个GWT购买的空间，实际上卖家只能提现得到995个GWT，剩下的5个GWT会被合约抽取。

由合约持有的GWT有两种使用方式：

1. 作为分红交给DMC的持有者（这里有一个分红逻辑）
2. 当算力不增长时，销毁GWT来减少GWT的流通

## DMC20 <-> GWT

### 销毁DMC20得到GWT

根据上述公式可知，系统有一个最快的GWT增发速度。如果一个矿工希望在早期迅速的扩大规模，此时可以通过销毁DMC的方式来得到GWT。销毁DMC会导致DMC的发行总量的减少。

销毁DMC得到的GWT的数量，与系统当前的总存储能力和当前周期的期望兑换总数有关。系统的总存储量越大，兑换得到的GWT也就越多。系统会记录一个周期内销毁DMC得到的GWT总量，销毁的DMC越多，说明得到GWT的愿望约强烈，系统会进一步提升单个DMC兑换GWT的比例以尽快满足GWT的流动性需求。

系统的总空间（定期同步）
当前的GWT总量
上个周期销毁的DMC总数，上个周期的总长度
上个周期销毁的DMC总量变化（增加或减少的百分比）
与当前的兑换DMC的比例比较，>=1.1 (至少多10%)


### 用GWT兑换未分配的DMC20

根据DMC1.0的白皮书，待挖矿（待释放的）DMC20保存在一个合约中，通过GWT可以兑换出来。
DMC20按周期释放，一个周期的DMC20兑换完成后会自动进入下一个周期。随着周期总数的增加，需要更多的GWT才能兑换得到DMC20
兑换DMC20的GWT会和GWT手续费一样，进入GWT分红/销毁池。

如果先兑换GWT得到DMC20，再销毁DMC20来得到GWT，通常是不划算的。但如果在早期先得到DMC20，持有一段时间后再销毁，正常会得到更多的GWT。

当前周期的DMC释放量 （上周期未兑换完量+本周期释放量）
上周期兑换剩余的DMC量（百分比）
得到当前周期的DMC兑换比例

```python
def exchange(self, gwt):
    先判断是否需要移动到下一个周期
    如果要：
        结算当前周期
        移动到下一个周期

    # 通过GWT兑换DMC20
    real_dmc_count = 0
    dmc_count = gwt / get_exchange_rate()
    if dmc_count > 本阶段DMC可释放余额:
        本阶段DMC可释放余额 = 0
        real_dmc_count = 本阶段DMC可释放余额
    else:
        本阶段DMC可释放余额 -= dmc_count
        real_dmc_count = dmc_count


def 结算当前周期


def 移动到下一个周期
    本期额为兑换量 = 未兑换总量/未兑换周期总数
    未兑换总量 = 未兑换总量 - 未兑换总量/未兑换周期总数
    本周期DMC可释放余额 = 未本期额为兑换量 + 本周期计划释放量
    exchange_rate = last_exchange_rate * （1-上期未兑换量/上期总兑换量）


def 销毁dmc(self,dmc_count):
    （系统总空间 / 已释放DMC） * 20
     

```


## DMC DAO的治理

### DMC <-> DAO Token


### GWT分红

每条链上的GWT合约都会有一个分红池，通过基金会的Oracle机制同步到DMC20的发行链上，随后DMC20的有权分红者就可以通过DMC合约领取GWT分红。这意味着全网所有通过分红得到的GWT，都只会在一条链上发行。

系统也可以设定，有一定比例的GWT会进入公共数据挖矿的奖励池（或特定的公共数据）。这样可以进一步激励用户参与公共数据挖矿。


## GWT/DMC 的全网兑换

### GWT 全网兑换
DMC我们选择一条链发行(ETH or X1),而GWT可以在所有的EVM兼容链上发行（依旧需要基金会部署合约）
我们通过去中心资产桥来实现不同链之间的GWT的兑换
DMC不支持跨链兑换。

### DMC->DMC20

从风险的角度考虑，我们实现的是单向转换（应该没有去中心跨链桥支持DMC1.0）。
基本是自动化系统，平均登记到转出的时间在3天内。
从安全的角度考虑，一个地址每天能得到DMC20的数量是有效的

## 一些担忧的思考

### 经济模型设计问题带来的GWT过多

GWT过多，会带来GWT的价格下降。随后用户存储的成本下降，但供给端会应为收益下降而减少可用存储空间，或则提高单价。
实际上出现了供小于求的情况：

- 系统的算力进入副增长（算力增长率作为算力的导数，副增长的更快），算力奖励快速归零
- 用户几乎不得到算力奖励，但支付同样的存储需要消耗更多的GWT了
- 供应商的主要收入来自于用户支付的GWT，而非算力奖励
- 系统的交易抽成增加，但因为算力并不增长，因此这部分抽成相当于销毁了

### GWT全网流转是否会带来问题（DMC只在一条链上）

GWT在ChainA=>ChainB之间转移,使用中心化跨链桥（最好找第三方的EVM兼容跨链桥）
ChainA的总供应会减少，ChainB的总供应会增加。进而影响两条链上的GWT奖励模型
跨链桥是自由的，因此任何人都可以自由的在不同链上搬运GWT，进而实现跨链价值的统一
一旦一条链的挖矿难度低，进而获得GWT变得容易，则会有更多的用户前往该链上挖矿，进而拉平GWT的获取难度


### 自刷挖矿的问题

如果挖矿奖励 > 交易抽成(千分之3)，那么用户就有动力自己扮演供应商和需求者，进而自刷挖矿
早期的自刷挖矿因为会锁定GWT的流动性，因此我们并不会过多担心
自刷挖矿的风险主要在于，有的链上挖矿简单，通过该链上自刷获得了比其他矿工更大的优势
    1. 挖矿是自由的，因此其他矿工也会前往改链自刷，来拉平优势
    2. 对于用户来说，手续费更低的链总是会让去中心存储的成本下降，因此需求也会不断的在我们支持的链上迁移



## 术语解析

### 基本经济学概念

- 质押率 （0.5 - 16）
- 定价 （0.125 - 8）
- 存储最小有效周期： 24周

### 系统的关键经济学参数

- 最小质押率
- 最低价格
- 最高价格
- 最小挑战间隔周期 56
- 挑战超时周期
- 诉讼费用