# DMCX 核心经济模型设计

相比DMC，DMCX的经济模型会更加简洁。希望通过一些简单的，可博弈的公式让每个人都能用自己的方式和策略，充满信心的加入到去中心存储市场中来。经济模型设计引导的博弈是阳谋，在推动整个去中心存储生态的算力规模增大的同时，推动DMC20价格的上涨。

## GWT、DMCX以及之间的兑换

### GWT/DMCX基本理念介绍

1. GWT的基本逻辑来源于传统的央行货币增发理论（无上限)
首先有一个合理的基础CPI设定，可以理解成存100块钱定期在银行，每年的利息就是一个合理增发量。考虑到Web3属性，我们认为比较合理的一个终局是每个月2%的利息。

2. 如果经济体很小，或在高速增长，那么增发率会进一步提高以增加货币供给的速度
根据现在的总算力规模，和算力规模增长速度，对利率进行修正。最大可以让月度增长率达到30%。

3. 公共数据挖矿和私有数据挖矿还有一些自己的业务逻辑，来对GWT的产出效率进行修正，其根本目的是规范让矿工的行为更常规

4. DMCX是每周期固定释放的，因此GWT挖的再多，一个周期能兑换的DMC也是固定的。GWT产出快时，DMCX能兑换的GWT就越多

5. DMCX是权益币，主要用途是：销毁得到GWT，质押得到分红，提案投票。

### DMCX 的释放模型

从2024年8月开始一共有420个周期，每个周期大概是现实世界的1周。每21个周期进行一次难度调整。难度调整后的周期释放的Token是上一个周期的80%。总释放为5亿DMC。

第1-21周，每周最多释放480万枚DMC。随后的第21-42周，每周最多释放480万*0.8枚DMC。

### DMCX<->GWT的兑换

通过exchange.sol合约的接口，用户可以在一个周期里进行GWT<->DMCX的兑换。GWT和DMCX的兑换比率(ex_rate)是动态变化的.ex_rate每个周期开始时确定，在整个周期内不变。

基于该ex_rate:

- 可以将1000个GWT兑换成 ( 1000 / ex_rate) 个DMCX，兑换得到的DMCX来自本cycle待释放的DMCX（如果待释放DMCX消耗完了该调用会失败）,消耗的GWT会进入DMC DAO的分红池。
- 可以将1000个DMCX兑换成 ( 1000 * ex_rate * 1.1) 个GWT，该调用总是会成功,消耗的DMCX会被销毁。

#### ex_rate的变化

ex_rate变化的基本逻辑是：

- 如果一个cycle里的DMCX都被兑换完了，那么下一个cycle的ex_rate就会增加,增加的比率和兑换完的时间有关，兑换的速度越快则ex_rate增加的越多，最多增加20%。
- 如果一个cycle里的DMCX没有兑换完，那么下一个cycle的ex_rate就会减少，剩余的未兑换DMCX越多则ex_rate下降的越多。ex_rate的下降最多为-20%。未兑换完成的DMCX会平滑的分配到未来的一些周期里，影响这些周期的可释放DMCX数量。

### 质押DMCX的分红奖励

DMCX的持有者可以将自己的DMCX质押到DMC DAO中，质押的DMCX会参与分红。分红的奖励来自于DMC DAO的分红池.其基本规则是：

- dividend_cycle: 分红周期，每次DMC DAO的分红池获得收入都会打入当前周期。获得收入时，还会检查当前时间与本周期启动时间的差，如果差大于3天，则开始一个新的分红周期，新的divident_cycle是当前cycle,并把上一个cycle标记为结束。
- 已结束的cycle里有确定的总收入和总质押DMCX数。
- 用户质押的DMCX，总是进入下一个分红周期（要等待下一个分红周期的开始）
- 用户可以从已结束的cycle里提取自己的分红奖励，提取的奖励是 (用户在该cycle质押的DMCX数 / 该cycle总质押DMCX数) * 该cycle总收入

### DMC DAO

DMCX DAO主要有两个主要的合约组成

1. 分红合约 (dividend.sol)
2. 提案与投票合约 (proposal.sol)

通过上述两个合约，DMCX DAO可以实现分红和治理。功能如下：

1. 任何DMCX的持有者，都可以在分红合约里质押DMCX并得到DMCX生态收入的分红。
2. 每个地址质押DMCX后有 `3天`的锁定期。
3. 任何质押了DMCX的用户都可以参与投票，投票后其票数为质押的DMCX数量。每个提案每个用户只能投票一次。
4. 质押DMCX满足一定条件的用户（目前是大于等于5万DMCX）可以发起投提案(投票)，提案的截止日期不大于3天。


### GWT 全网兑换（未开放）

DMC我们选择一条链首发(XLayer),以后GWT可以在所有的EVM兼容链上发行（依旧需要基金会部署合约）
我们通过去中心资产桥来实现不同链之间的GWT的兑换
DMCX不支持跨链兑换。

### DMC1.0 -> DMCX (未开放)

从风险的角度考虑，我们实现的是单向转换（应该没有去中心跨链桥支持DMC1.0）。
基本是自动化系统，平均登记到转出的时间在3天内。
从安全的角度考虑，一个地址每天能兑换的DMCX的数量是有效的

## 公共数据挖矿

公共数据挖矿合约里一共有3类用户，分别是：Supplier，Data Owner，Data Supplier。Supplier保存了完整的公共数据，通过SHOW数据的存储证明来获得激励（公共数据挖矿），Data Owner是公共数据关联的NFT的Owner，Sponoser是公共数据的赞助商,通常是第一个将NFT加入到公共数据合约中的用户。

公共数据挖矿的基本流程是：

1. Sponsor创建公共数据,并给公共数据充入第一笔GWT余额。这笔GWT一部分会进入公共数据的本轮竞赛奖池。
2. Supplier质押GWT成为Supplier
3. Supplier在矿机上保存公共数据，并在适当的时机展示公共数据的存储证明(SHOW)，获得奖励。奖励一方面来自公共数据的余额，一方面来自于算力奖励。
4. Supplier在SHOW成功后，公共数据在本轮竞赛中的积分会增加。积分增加的多少取决于数据的大小。
5. 一段时间后本轮竞赛结束，分数最高的前32个公共数据会按比例瓜分本轮竞赛奖池。
6. 获胜数据的Sponsor,Data Owner ,Supplier可以按比例瓜分该数据的获奖金额

### 创建公共数据需要准备的GWT

创建公共数据的用户需要为公共数据充入第一笔GWT余额，为了保障后续的公共数据挖矿的正常运行，该余额有一定的最小值要求。最小值的计算公式如下：

```
创建时需要准备的GWT = 公共数据最小质押率(16) * 公共数据大小（单位GB） * 最小时长(96周) * 创建倍率(3倍)
```

首次充值的80%会成为公共数据的余额，20%会进入本轮竞赛奖池。


### Supplier(矿工) SHOW一个公共数据需要准备的GWT质押币

Supplier（矿工）是真正保存公共数据的人，他们把公共数据保存到本地，并在合适的时机SHOW存储证明以得到奖励。DMCX的存储证明基于ERC7585构造，要出示一个存储证明，就必须基一个“基准块高度”开始计算，在有效块高度前(目前是3个区块，在XLayer上大概是10秒，包含上链时间)完成计算并提交到链上就是一次有效的存储证明。ERC7585的机制里，链上的合约并不能100%验证存储证明的正确性，而是基于博弈模型：如果有人发现了一个更好的存储证明，那就说明之前上链的是Fake的存储证明（挑战成功）。挑战成功的矿工会拿走提交Fake证明用户的质押币。


基于上述流程，矿工在开始公共数据挖矿之前必须需要准备一定的质押币。质押币的需求和其潜在收益有关，公式如下：

***Normal模式GAS费高，质押币需求低***

这里的质押是根据SHOW 数据大小的一般性质押，需要的质押币数量是：

```
pledgeRate *_dataSizeToGWT(dataSize) * sysConfig.minLockWeeks 
```

Normal模式下，Show成功时间的计算是第二次合约调用，因此对于有大量balance的公共数据使用Normal模式无法快人一步得到更大的收益。

***immediately模式 GAS费低，质押币需求高***

这里的质押是指根据SHOW收益决定的质押，和数据的Balance有关。需要锁定的Supplier的质押币数量是:

```
(datablance*0.1*2) + pledgeRate *_dataSizeToGWT(dataSize) * sysConfig.minPublicDataStorageWeeks 
```

当datablance过低时，立即模式附加的GWT需求至少为210 GWT。

### 停止SHOW（冷却）等待质押币解锁

每次SHOW公共数据后，Supplier的质押币都会按上述公私被冻结一部分，并更新冻结时间。因此如果Supplier有足够多的质押币的情况下，Supplier可以同时SHOW多个公共数据。

当当前时间大于冻结时间时，所有的质押币都会解冻并可用。因此Supplier的策略应该是一口气SHOW多个公共数据，把可用质押币都用完，同时得到了GWT奖励。这些奖励可以立刻质押进来获得更多的非冻结质押币，也可以一段时间内部SHOW，等待质押币解锁后再开始下一批的SHOW。


### Supplier(矿工) SHOW成功后的奖励

- 第一次SHOW成功得到的来自于公共数据余额的奖励

```
SHOW奖励 = public_data.balance * 0.1
```

- 非第一次SHOW成功得到的公共数据余额+算力奖励，算力奖励还会增加公共数据的余额

GWT算力奖励是DMCX经济模型里的关键组成部分。其基本规则是：

```
算力 = 距离上一次SHOW成功的时间 * 公共数据大小 * 公共数据价格倍率(16) * 质押率(pledgeRate)
当前周期总算力 = 当前周期总算力 + 算力
算力奖励 = 算力 * 算力奖励系数 * 0.8
公共数据余额增加 = 算力 * 算力奖励系数 * 0.2
```

算力奖励系数是一个和两次SHOW时间有关的函数，其设计逻辑在于通过首次SHOW和当前SHOW所在周期的平均总算力和平均算力增长率，通过一个公式得到一个算力奖励系数。算力奖励系数的计算公式的基本原则是与平均总算力成反比，与平均算力增长率成正比，公式如下：

```python
def getGWTDifficultRatio(total_size,growth_rate):
    m =  1024*1024 - 1024*8*growth_rate
    result = (0.243*m) / (total_size+0.867*m) + 0.02

    return result
```



### SHOW与挑战

基于同一个区块，第一次提交公共数据的存储证明被称作SHOW，非第一次则为视为挑战。如果挑战展示的存储证明比上一次的存储证明更好，则挑战成功，挑战者能立刻拿走上一个存储证明提供者的质押币(Normal模式和immediately模式的总数不同)，并锁定按自己选择模式所需的质押币。否则挑战失败，挑战失败后挑战者只损失了手续费。在SHOW调用后，如果一段时间里没有人挑战成功，则SHOW最终成功，此时使用Normal模式SHOW的矿工可以发起withdrawShow调用获得SHOW奖励。

## 公共数据排行榜

### 成功的SHOW会增加公共数据的积分

SHOW成功后数据在当前奖励周期的积分会增加，积分增加的数量只和数据的大小有关。1G以及一下的数据算1分，随后数据大小每次翻倍，积分增加1分。
挑战成功不会增加公共数据的积分。


### 排行榜规则

有了公共数据积分的规则，我们就可以按积分给公共数据排名。从原理上，排名越好的公共数据，其累计的有效存储证明数量也就越多，也就有更好的可靠性和可用性，是更优质的公共数据。DMCX通过公共数据排行榜奖励激励更多的公共数据变成优质的公共数据。

在XLayer上，排行榜的周期是固定区块数,约为3天。
```
sysConfig.blocksPerCycle = 86400;// Each cycle is 72 hours
```

每个排行榜周期开始时，都会重置所有公共数据在本周期的积分。排行榜还有一个进入排名的阈值（64分），未到达这个分值的公共数据无法进入排行榜。

排行榜的大小为32.

### 排行榜奖励

进入排行榜的公共数据可以瓜分本期排行榜的奖池。排行榜的奖池主要来源是给公共数据充值的20%GWT。以及上期排行榜的一部分。

```
公共数据本期奖励 = 本期奖池余额 * 0.8 * 本期百分比
```

第一名的本期百分比是15%，第二名是11.25%，第三名是9.3%... 第32名是0.8%
为了让每期的奖池更加稳定，本期奖池的15%会进入下期排行榜的奖池,5%进入DMC DAO的分红池。

#### 排行榜奖励的分配

当公共数据在一个奖励周期结束后进入了排行榜，任何人都可以发起合约调用来分配奖励（从利益相关来看，该操作一般是公共数据的Sponosr调用）。如果公共数据获得了100GWT的排行榜奖励，那么这100GWT的分配如下：

- 50%给Sponosr
- 20%给Data Owner, Data Owner的确认是根据PublicData关联的NFT的Owner来确认的
- 30%给最后Show的5个矿工，每个矿工可以拿到6%


### 抢获奖数据的Sponosr

任何用户都可以调用 addDeposit 给公共数据充值，当充值的金额超过公共数据最大单次充值的110%时，本次充值的用户会成为新的Sponosr。根据上述经济模型，在一个公共数据即将赢得排行榜时，如果潜在的奖励超过了成为公共数据Sponosr的成本，那么去抢Sponsor是一个有利可图的行为。


## 存储交易市场挖矿 （即将上线）

1. 出售存储资源的用户被称作供应商，可以挂卖单，卖单应详细的描述其存储资源的定义和价格。约定：

- 存储总大小，
- 存储单价（定价单位从0.125到8,单位是GWT(Gb per Week Token）
- 存储有效时间（系统规定最小有效期为24周），
- 单次购买的最小大小(需小设置为2GB)。
- 存储质量

2. 挂卖单时矿工用GWT缴纳质量保证金，用来在存储出现问题时赔付给用户。

```
保证金总额 = 卖单总空间*有效时间*单价*质保比率
```

系统有要求最小质保比率(0.5)，用户可以根据实际的市场竞争调高该保证金。存储价格，质保比率会影响供应方在算力奖励里的比率。
比如用户有100G空间，挂单24周，价格是2，质保比率是0.5,那么在挂单时，矿工需要准备好 `100*24*2*0.5 = 2400`个GWT的质保金。

3. 有需求的用户（需求方）可以选择一个已挂单购买自己需要的空间

```
存储费用=需求空间*剩余有效时间*单价。
```
用户并不能选择有效时间。当一个存储订单的剩余有效时间小于系统的最小存储有效时间时，用户无法购买该存储订单。为了降低GAS Fee，用户在购买空间时应设置数据的MixHash.

4. 已成交订单进入等待（数据）状态。数据交付的流程是需求方首先根据供应方公开的账号信息，通过链下协议将数据传输给供应商。供应商收到数据后调用合约接口确认该数据的MixHash。此后订单进入交付状态。

5. 未进入交付状态的订单双方都可以随时取消。取消后，用户会立刻得到退款，矿工则是回复了该存储订单的空间。

6. 订单进入交付状态12周后，可以调用“提现操作”，提现操作会让供应方得到收入+算力奖励GWT，让用户得到算力奖励GWT。此时系统会在该过程中抽取一部分交易费用GWT。

7. 矿工可以随时减少卖单的有效剩余空间。有效剩余空间减少后，矿工会得到退还的质保金。

8. 当矿工发现数据丢失时，可以主动声明数据丢失。此时只会赔付给用户质保金的80%，并拿回剩余的20%。

9.	供应方因为正常的技术理由可以申请订单请假（请假的频率基于有效长度有最大限制），订单请假期间其无法发起存储挑战。供应方可以在主动调用合约接口将请假状态的订单恢复正常。

10.	存储订单可以协议取消（一方发起，另一方同意），此时双方都会得到剩余交付时间的退款。

11. 使用官方的挖矿软件不会碰到其它异常情况，因此本文不讨论存储挑战等情况下的经济模型

### 交易费用

针对任何处于交付状态的订单进行提现，都会收取交易费用。

在存储交易的过程中，合约会抽取一部分比率的交易费用。比如买家花了1000个GWT购买的空间，实际上卖家只能提现得到995个GWT，剩下的5个GWT会被合约抽取。

由合约持有的GWT有两种使用方式：

1. 作为分红交给DMC的持有者（这里有一个分红逻辑）
2. 当算力不增长时，销毁GWT来减少GWT的流通

### 算力奖励

整理中

### 交易的取消

整理中

### 提现周期

整理中

### 自刷挖矿的问题

如果挖矿奖励 > 交易抽成(千分之3)，那么用户就有动力自己扮演供应商和需求者，进而自刷挖矿
早期的自刷挖矿因为会锁定GWT的流动性，因此我们并不会过多担心
自刷挖矿的风险主要在于，有的链上挖矿简单，通过该链上自刷获得了比其他矿工更大的优势
    1. 挖矿是自由的，因此其他矿工也会前往改链自刷，来拉平优势
    2. 对于用户来说，手续费更低的链总是会让去中心存储的成本下降，因此需求也会不断的在我们支持的链上迁移


### 矿工的基本策略

1. 根据自己的存储能力，决定存储的价格和质押率
2. 根据对挖矿奖励的期望，决定存储的价格和质押率
3. 适当的挂出卖单，因为每次挂单都有可能真正的锁定GWT质押，因此需要谨慎操作
4. 手工撤回为成交的卖单，已得到质押GWT的立刻退还
5. 自动的处理存储订单的交付，也可手工处理黑名单用户的订单。
6. 理解挖矿规则后，从节约手续费、锁定有利的系统参数、以及及时获得流动性3个角度在合适的时候提现。
7. 在GWT全链转换的基础上，认证思考如何在不同链上挖矿（寻找挖矿难度更低的链），以及合适转移GWT


