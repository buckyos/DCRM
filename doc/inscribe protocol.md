# DMC 铭文协议 （Public Data Inscribe,short for PDI）
设计目标是在保持和现有Orindal协议尽量兼容的基础上，能实现DMC的Mint,公共数据铭文的铭刻、吟唱、共鸣
按铭文协议的基本框架扩展是一个思路，在BRC20上扩展“call” 又是另一个思路

## Mint DMC
使用标准的Orindal协议进行Mint，根据现在部署的BRC20，成功获得210个DMC
我们的扩展增加了“lucky”关键字，当带有该关键字的交易进入被 区块高度与自己的地址的和被32整除的区块时，用户会得到210个DMCs+1890个DMC-SP。lucky mint在未进入正确区块时，蜕化成普通mint,只获得210个DMCs而没有DMC-SP.

```
{"p":"brc-20","op":"mint","tick":"DMC ","amt":"210","lucky":"dmc-discord"}
```

为了把现在DMC主网的token迁移过来，我们有一个记录在ETH合约里的“DMC销毁公开列表”。说明了lucky的一些特殊值。线定用户用这些特殊值进行mint时，会得到公开列表中说明的DMC数量。该公开列表一旦发布，就不会变化。该列表包含的DMC上限为4000万DMC。

## 铭刻（inscribe）公共数据铭文
"铭文内容包含在揭示交易的输入中，铭文是在其第一个输出的第一个sat上制作的。" 

铭刻公共数据铭文的协议使用Orindal协议里创建NFTs的逻辑，但使用我们约定的metadata.

铭刻时系统会从ETH网络中同步一些公共数据的MetaData过来，作为首次铭刻者，用户也可以写入不可修改的铭文文本（我们鼓励文本内容是对这个公共数据的感受）。在铭刻时，也可以同步设置共鸣价格。

铭刻公共数据需要用户支付数量为 2n 的DMC。
```
#基础分
def get_basic(data_size):
    x = 0
    start_size = 128*1024*1024
    if data_size > start_size:
        x = data_size - start_size
    return 999 / (1 + math.exp(-0.00000762939453125*(x))) + 1

基本倍率 
def get_basic_rate(data_points):
    return 19 / (1 + math.exp(-0.15*(data_points-90))) + 1

#n = 基础分*基础倍率
def get_n(data_size,data_points):
    return get_basic(data_size)*get_basic_rate(data_points)
```
1. 任何公共数据的积分(Points)默认是1.
2. 用户为铭刻公共数据铭文支付的DMC的98%会进入 DMC Mint Pool，剩余的2%作为手续费进入基金会账户。

Mint数据成功的条件：
a. 一个公共数据只能被铭刻一次。
b. 用户的address与公共数据的hash满足一定的阈值abs（datahash - address) % 32 = 0。其基本逻辑是对任意公共数据，用户总有1/32的概率是可以有资格铭刻的。
c. 在同一个区块里的铭刻并不遵循传统的先到先得效原则，如果在一个区块里同时有多个用户铭刻同一个公共数据，那么和公共数据距离（距离计算：user_addr xor data_hash ）最近的用户可以铭刻成功，其它用户的交易失败，但是不会退回DMC。
d. 铭刻时的amt设置要大于等于上述支付金额要求。小于要求的amt会导致铭刻失败，会退回DMC。

```
{"p":"pdi","op":"inscribe","ph":"$hash","text":"$text bind to public data","price":"100"}

```
## 吟唱（Chant）公共数据铭文
吟唱公共数据铭文来获得DMC奖励。
```
吟唱奖励 = n
吟唱体力 = n / 4
```

如果吟唱的数据铭文不是自己拥有的，那么无法得到100%的吟唱奖励，会有20%的奖励被转移到铭文的当前拥有者身上
```
{"p":"pdi","op":"chant","ph":"xxx"}

```
吟唱成功的条件
    1.用户拥有该铭文或用户共鸣了该数据铭文
    2.公共数据Hash与进块的块高度满足一定的关系（DataHash - Block.Height）% 32 == 0
    3.用户有和数据价值相当的DMC余额 (吟唱体力 )，吟唱体力的限制是为了防止高价值数据通过共鸣被大范围的吟唱
    4.同一个用户在一个区块里，只能吟唱一次

## 转移公共数据铭文的Owner
使用Ordinal的标准NFT方法转移铭文Owner

## 给公共数据铭文定一个 共鸣 （Resonance）价格
公共数据铭文默认不允许共鸣 （共鸣价格是0）
用户需要通过一条特殊的交易来设置共鸣价。设置后数据铭文可以共鸣。共鸣价存在上限：
```
price_limit = n*2
```
下面是协议的示例
```
{"p":"pdi","op":"set","ph":"xxx","price":"1000"}
```


## 与一个公共数据铭文 共鸣（Resonance）
- 向数据铭文的拥有者转账，并设置想要共鸣的公共数据Hash。系统会收取20%的手续费进入基金会账户。
- 转账金额小于该当前设置的铭文共鸣价时，共鸣失败。会退款。
- 共鸣成功后，用户可以在后续吟唱该数据铭文。
- 如果目标用户不拥有该数据的铭文，共鸣失败，会退款。
```
{p:"pdi","op":"res","tick":"DMC ","amt":"1000",ph:"$datahash"}
```
自己共鸣自己的铭文可能会带来简单的放大问题，因此继续增加下面三条限制
1. 设置共鸣的最大数量 ： 15
2. 因为有共鸣数量上限，所以一个区块内提交的共鸣请求时根据用户账户和数据PH的距离决定的。距离最小的会成功。
3. 如果连续12800个区块内没有调用吟唱（约3个月），会失去共鸣资格。

## 用户与公共数据铭文的关系
要注意的是，用户和一个公共数据的关系是确定的。一共有3种关系
1. 没关系
2. 共鸣
3. 拥有

用户与数据处于共鸣关系时，如果用户通过NFTs转账得到了该公共数据铭文，那么关系会自动变成拥有。此时公共数据的共鸣资格总数会减少1。（释放出了一个可共鸣位置）

## 公共数据铭文的套装效果 （下个版本）
- 通过ETH网络可以查询MixHash的系列ID
- 当用户持有同一个系列的铭文超过3，5，9个时，会触发不同的套装效果。套装效果会在吟唱时生效。
- 套装生效的条件是所有的数据铭文的积分都超过66

## DMC Mint Pool
Mint DMC和吟唱铭文操作都会影响DMC Mint Pool的余额，当DMC Mint Pool余额不足时，上述操作即使成功也无法得到足够的DMC奖励。

## 基金会账户
铭刻和共鸣行为收取的手续费会进入基金会账户，用来对生态的发展进行平衡。包括支持从其他DMC网络转移过来的DMC。

